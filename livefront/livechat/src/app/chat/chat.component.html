<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h2 class="text-center mb-4">Live Chat</h2>

      <!-- Login Form -->
      <div *ngIf="!connected" class="card bg-dark text-light">
        <div class="card-body">
          <form #loginForm="ngForm" (ngSubmit)="connect()">
            <div class="mb-3">
              <label for="username" class="form-label">Usu√°rio:</label>
              <input
                type="text"
                id="username"
                class="form-control"
                [(ngModel)]="username"
                name="username"
                required
                placeholder="Enter your username"
                (keypress)="handleKeyPress($event, loginForm)"
                [disabled]="connecting"
              >
            </div>
            <button
              type="submit"
              class="btn btn-primary w-100"
              [disabled]="!username.trim() || connecting"
            >
              {{ connecting ? 'Conectando...' : 'Join Chat' }}
            </button>

            <!-- Error Message -->
            <div *ngIf="connectionError" class="alert alert-danger mt-3" role="alert">
              {{ connectionError }}
            </div>
          </form>
        </div>
      </div>

      <!-- Chat Box -->
      <div *ngIf="connected" class="chat-box">
        <!-- Messages Container -->
        <div #chatMessages class="chat-messages mb-3">
          <ul class="list-unstyled">
            <li *ngFor="let msg of messages" [ngClass]="{'text-center': msg.type !== 'CHAT'}">
              <!-- Regular Chat Message -->
              <div *ngIf="msg.type === 'CHAT'" class="message-content" [ngClass]="{'own-message': isOwnMessage(msg)}">
                <span class="username">{{ msg.user }}:</span>
                <span class="message">{{ msg.content }}</span>
                <small class="text-muted time">{{ formatTime(msg.time) }}</small>
              </div>

              <!-- System Message -->
              <div *ngIf="msg.type !== 'CHAT'" class="system-content">
                {{ msg.content }}
                <small class="text-muted time">{{ formatTime(msg.time) }}</small>
              </div>
            </li>
          </ul>
        </div>

        <!-- Message Input Form -->
        <form #messageForm="ngForm" (ngSubmit)="sendMessage()" class="mb-3">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              [(ngModel)]="message"
              name="message"
              required
              placeholder="Digite uma mensagem..."
              (keypress)="handleKeyPress($event, messageForm)"
              [disabled]="!connected"
            >
            <button
              class="btn btn-primary"
              type="submit"
              [disabled]="!message.trim() || !connected"
            >
              <i class="bi bi-send"></i> Send
            </button>
          </div>
        </form>

        <!-- Disconnect Button -->
        <button
          class="btn btn-danger w-100"
          (click)="disconnect()"
          [disabled]="!connected"
        >
          <i class="bi bi-box-arrow-right"></i> Sair do Chat
        </button>
      </div>
    </div>
  </div>

  <!-- Reconnecting Alert -->
  <div *ngIf="connecting && connected" class="position-fixed bottom-0 end-0 p-3">
    <div class="alert alert-warning" role="alert">
      Reconectando ao chat...
    </div>
  </div>
</div>
