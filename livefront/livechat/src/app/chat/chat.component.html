<div class="container">
  <h2 class="text-center mb-4">Live Chat</h2>

  <!-- Login Form - Show when not connected -->
  <div *ngIf="!connected" class="login-form mb-4">
    <form #loginForm="ngForm" (keydown)="handleKeyPress($event, loginForm)">
      <div class="form-group">
        <label for="username">Username:</label>
        <input
          type="text"
          id="username"
          name="username"
          class="form-control"
          [(ngModel)]="username"
          required
          [disabled]="connecting"
          placeholder="Enter your username"
        >
      </div>

      <button
        type="button"
        class="btn btn-primary w-100 mt-3"
        (click)="connect()"
        [disabled]="!username.trim() || connecting"
      >
        {{ connecting ? 'Connecting...' : 'Join Chat' }}
      </button>

      <div *ngIf="connectionError" class="alert alert-danger mt-3">
        {{ connectionError }}
      </div>
    </form>
  </div>

  <!-- Chat Interface - Show when connected -->
  <div *ngIf="connected" class="chat-box">
    <!-- Messages Container -->
    <div #chatMessages class="chat-messages mb-3">
      <div *ngFor="let msg of messages" class="message-wrapper">
        <div [class]="'message-content ' + (isOwnMessage(msg) ? 'own-message' : '')">
          <div class="d-flex justify-content-between align-items-start">
            <span class="username">{{ msg.user }}</span>
            <span class="time">{{ formatTime(msg.time) }}</span>
          </div>
          <div class="message-text">
            {{ msg.content }}
          </div>
        </div>
      </div>
    </div>

    <!-- Message Input Form -->
    <form #messageForm="ngForm" (keydown)="handleKeyPress($event, messageForm)" class="message-input-form">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          name="message"
          [(ngModel)]="message"
          placeholder="Type your message..."
          required
        >
        <div class="input-group-append">
          <button
            type="button"
            class="btn btn-primary"
            (click)="sendMessage()"
            [disabled]="!message.trim()"
          >
            Send
          </button>
        </div>
      </div>
    </form>

    <!-- Disconnect Button -->
    <button
      type="button"
      class="btn btn-danger w-100 mt-3"
      (click)="disconnect()"
    >
      Leave Chat
    </button>
  </div>
</div>

<!-- Reconnection Dialog -->
<div *ngIf="connecting && connected" class="reconnection-dialog">
  <div class="alert alert-warning text-center">
    Reconnecting to chat...
  </div>
</div>
